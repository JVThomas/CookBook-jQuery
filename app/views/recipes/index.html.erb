<h1><%= display_header(@user) %></h1>

<%if !@user%>
  <div>
    <h2>Want to search all recipes by ingredient? Enter the ingredient name below</h2>
    <%=form_tag recipes_path, method: :get do%>
      <%=label_tag :ingredient_name%>
      <%=text_field_tag :ingredient_name, params[:ingredient_name]%>
      <%=submit_tag "Search", name: :search%>
    <%end%>
  </div>
<%end%>

<div>
  <%@recipes.each do |recipe| %>
    <h3><%=display_index_links(recipe)%></h3>
    <div id = "details-<%=recipe.id%>"></div>
    <a href="#" class = "btn ingredientsLink" data-id="<%=recipe.id%>">Show Ingredients</a>
    <a href="#" class = "btn contentLink" data-id="<%=recipe.id%>">Show Instructions</a>
  <%end%>
</div>

<script type="text/javascript" charset = "utf-8">
  $(document).ready(function(){
    
    $('.ingredientsLink').on("click", function(event){
      event.preventDefault();
      var recipeId = $(this).data("id");
      $.get('/recipes/' +recipeId+ ".json").done(function(response){
        var injectText = "";
        response["recipe"]["recipe_ingredients"].forEach(function(details){
          injectText += "<p><strong>Ingredient:</strong> " + details["ingredient"]["name"]+ " /<strong> Quantity:</strong> " + details["quantity"] + "</p>";
        });
        $('#details-'+recipeId).html(injectText);
      }).fail(function(error){
        alert(error.statusText);
      });
    });

    $('.contentLink').on("click",function(event){
      event.preventDefault();
      recipeId = $(this).data("id");
      $.get('/recipes/' +recipeId+ ".json").done(function(details){
        $('#details-'+recipeId).html('<p>'+ details["recipe"]["content"]+'</p>');
      }).fail(function(error){
        alert(error.statusText);
      });
    });
  
  });
</script>

